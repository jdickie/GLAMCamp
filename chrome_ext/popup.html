<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>client</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Grant Dickie">
	<!-- Date: 2012-02-16 -->
<style>
body {
  min-width:357px;
  overflow-x:hidden;
}

img {
  margin:5px;
  border:2px solid black;
  vertical-align:middle;
  width:75px;
  height:75px;
}
#output_display {
	padding: 10px;
	font-size: 28px;
	display: inline;
	margin: 0 10px 10px 10px;
}
#output_display p {
	margin: 5px 0 0 0;
	
}
#output_display p .output_record_item {
	display: block;
	padding: 2px;
}
#wikicite_controls {
	margin: 10px 0px 0px 10px;
}
#save_record {
	margin: 0px 500px 10px 10px;
	float: right;
	display: inline;
}
.button, .button:hover {
	margin: 10px 5px 5px 10px;
	padding: 5px;
	font-size: 14px;
	border: 1px solid red;
	width: 200px;
	cursor: pointer;
}
.button:hover {
	background: cyan;
}
</style>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/wikiCite.js"></script>
<script>
$(function() {
	var wikicite;
	console.log('starting script');
	// on start, performs following:
	// Save and Restart buttons
	$('#save').click(function(e) {
		if($('#output_display').html() !== undefined) {
			var txt = $('#output_display > p').text();
		
			$('#output_display > p > span').each(function(i, o) {
				txt += $(o).text();
				txt += $(i + ' > input').val();
			});
		
		
			$('#save_record > textarea').val(txt);
		}
	});
	wikicite = WikiCite({});
	
	// get domain info
    // var m = window.location.match(/^http:\/\/[^\/]+/);
    // domain = m[0];
    // get record fields hash from server
    $.ajax({
        url: 'http://demos.interedition.eu/sitos/citations/get_citation_method_by_domain',
        type: 'post',
        dataType: 'json',
        success: function(hash) {
			console.log('hash success ' + hash);
			
            // set the root element where the information we want is
            wikicite.setRootElement('table#record');

            // setting the record fields to the given hash
            wikicite.setRecordFields(hash);
            // parse together
            wikicite.parse();

            // get the citation string from server
            $.ajax({
                url: 'http://demos.interedition.eu/sitos/citations/get_citation_pattern_by_language',
                type: 'post',
                dataType: 'json',
                success: function(template) {
                    citation = wikicite.getCitation(template.pattern, '@@', '#output_display');
					// get output string and display
	                $('#output_display').text(citation);
                }
            });

            
        }
    });
	
});
</script>
</head>
<body>
	<div id="output_display">
		
	
	</div>
	<div id="save_record">
		<textarea id="final" rows='20' cols='20'></textarea>
	</div>
	<div id="wikicite_controls">
		<div id="load" class="button">LOAD</div>
		<div id="save" class="button">SAVE</div>
		<div id="restart" class="button">RESTART</div>
	</div>
	
</body>